<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Price</title>
    <style>        
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #1a1a1a;
            font-family: 'Anton', sans-serif;
            overflow: hidden;
        }

        .container {
            text-align: center;
            color: #ffffff;
        }

        .price-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .digit-container {
            position: relative;
            perspective: 1000px;
            height: 20vw;
            margin: 0 0.5vw;
        }

        .digit {
            position: relative;
            height: 100%;
            font-size: 20vw;
            color: #f2a900;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .flip-card {
            position: absolute;
            width: 100%;
            height: 50%;
            left: 0;
            overflow: hidden;
            backface-visibility: hidden;
        }

        .flip-card.top {
            top: 0;
            transform-origin: bottom;
            border-radius: 10px 10px 0 0;
            background-color: #2a2a2a;
        }

        .flip-card.bottom {
            bottom: 0;
            transform-origin: top;
            border-radius: 0 0 10px 10px;
            background-color: #222222;
        }

        .flip-card .digit-top,
        .flip-card .digit-bottom {
            position: absolute;
            width: 100%;
            height: 200%;
            left: 0;
            display: flex;
            justify-content: center;
            color: #f2a900;
        }

        .flip-card .digit-top {
            top: 0;
        }

        .flip-card .digit-bottom {
            bottom: 0;
        }

        .flip-animation-top {
            animation: flipTop 0.5s ease-in-out;
        }

        .flip-animation-bottom {
            animation: flipBottom 0.5s ease-in-out;
        }

        @keyframes flipTop {
            0% { transform: rotateX(0deg); }
            100% { transform: rotateX(-90deg); }
        }

        @keyframes flipBottom {
            0% { transform: rotateX(90deg); }
            100% { transform: rotateX(0deg); }
        }

        .dollar-sign {
            font-size: 20vw;
            color: #f2a900;
            display: inline-flex;
            height: 20vw;
            align-items: center;
        }

        .comma {
            font-size: 20vw;
            color: #f2a900;
            display: inline-flex;
            height: 20vw;
            align-items: center;
            margin: 0 0.2vw;
        }

        .label {
            font-size: 3vw;
            color: #cccccc;
        }

        .timestamp {
            font-size: 1.5vw;
            color: #888888;
            margin-top: 20px;
        }
        
        .hide {
            display: none;
        }

        @media (max-width: 768px) {
            .digit-container { height: 10vw; }
            .digit, .dollar-sign, .comma { font-size: 10vw; height: 10vw; }
            .label { font-size: 5vw; }
            .timestamp { font-size: 2.5vw; }
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Barlow+Condensed:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="label">Bitcoin Price (USD)</div>
        <div class="price-container" id="priceContainer">
            <div class="dollar-sign">$</div>
            <!-- Digits will be inserted here by JavaScript -->
        </div>
        <div class="timestamp" id="timestamp"></div>
    </div>

    <script>
        let previousPriceStr = null;
        const priceContainer = document.getElementById('priceContainer');
        const timestampElement = document.getElementById('timestamp');

        // Function to create flip digit element
        function createDigitElement(value, isComma = false) {
            if (isComma) {
                const commaElement = document.createElement('div');
                commaElement.className = 'comma';
                commaElement.textContent = ',';
                return commaElement;
            }

            const digitContainer = document.createElement('div');
            digitContainer.className = 'digit-container';
            
            // Create the digit display
            const digit = document.createElement('div');
            digit.className = 'digit';
            digit.textContent = value;

            // Create top flip card
            const topFlip = document.createElement('div');
            topFlip.className = 'flip-card top';
            
            const topDigitTop = document.createElement('div');
            topDigitTop.className = 'digit-top';
            topDigitTop.style.fontSize = '20vw';
            topDigitTop.textContent = value;
            
            topFlip.appendChild(topDigitTop);
            
            // Create bottom flip card
            const bottomFlip = document.createElement('div');
            bottomFlip.className = 'flip-card bottom';
            
            const bottomDigitBottom = document.createElement('div');
            bottomDigitBottom.className = 'digit-bottom';
            bottomDigitBottom.style.fontSize = '20vw';
            bottomDigitBottom.textContent = value;
            
            bottomFlip.appendChild(bottomDigitBottom);
            
            // Add all elements to container
            digitContainer.appendChild(digit);
            digitContainer.appendChild(topFlip);
            digitContainer.appendChild(bottomFlip);
            
            return digitContainer;
        }

        // Function to format price with commas
        function formatWithCommas(price) {
            return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Function to update display
        function updateDisplay(priceStr) {
            // Clear previous digits except dollar sign
            while (priceContainer.childNodes.length > 1) {
                priceContainer.removeChild(priceContainer.lastChild);
            }
            
            // Add each digit
            for (let i = 0; i < priceStr.length; i++) {
                const char = priceStr[i];
                if (char === ',') {
                    priceContainer.appendChild(createDigitElement(char, true));
                } else {
                    priceContainer.appendChild(createDigitElement(char));
                }
            }
        }

        // Function to animate digit change
        function animateChange(oldPrice, newPrice) {
            const oldPriceFormatted = formatWithCommas(oldPrice);
            const newPriceFormatted = formatWithCommas(newPrice);
            
            // First update display with the old price
            updateDisplay(oldPriceFormatted);
            
            // Set a timeout to allow the DOM to update
            setTimeout(() => {
                // Get all digit containers
                const digitContainers = document.querySelectorAll('.digit-container');
                
                // Prepare the new digits but don't show them yet
                const newDigits = newPriceFormatted.split('');
                let commaOffset = 0;
                
                // For each digit, check if it needs to change
                for (let i = 0; i < digitContainers.length; i++) {
                    const container = digitContainers[i];
                    const oldChar = oldPriceFormatted[i] || '';
                    const newChar = newPriceFormatted[i] || '';
                    
                    if (oldChar !== newChar) {
                        // Get flip elements
                        const topFlip = container.querySelector('.flip-card.top');
                        const bottomFlip = container.querySelector('.flip-card.bottom');
                        const digit = container.querySelector('.digit');
                        
                        // Set the current value
                        topFlip.querySelector('.digit-top').textContent = oldChar;
                        bottomFlip.querySelector('.digit-bottom').textContent = oldChar;
                        
                        // Prepare animation
                        // First update the bottom card to show new value but keep it hidden
                        bottomFlip.querySelector('.digit-bottom').textContent = newChar;
                        
                        // Start animations
                        topFlip.classList.add('flip-animation-top');
                        
                        // After top card flips halfway, change the displayed digit and flip bottom card
                        setTimeout(() => {
                            digit.textContent = newChar;
                            bottomFlip.classList.add('flip-animation-bottom');
                        }, 250);
                        
                        // Remove animation classes after animation is complete
                        setTimeout(() => {
                            topFlip.classList.remove('flip-animation-top');
                            bottomFlip.classList.remove('flip-animation-bottom');
                            topFlip.querySelector('.digit-top').textContent = newChar;
                        }, 500);
                    }
                }
            }, 50);
        }

        async function fetchBitcoinPrice() {
            try {
                // Try to fetch actual price
                try {
                    const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd');
                    const data = await response.json();
                    const currentPrice = Math.floor(data.bitcoin.usd); // Use integer price for simplicity
                    const currentPriceStr = currentPrice.toString();
                    
                    // Update timestamp
                    timestampElement.textContent = `Last updated: ${new Date().toLocaleString()}`;
                    
                    // If this is the first fetch, just show the price without animation
                    if (previousPriceStr === null) {
                        updateDisplay(formatWithCommas(currentPriceStr));
                    } 
                    // Otherwise, animate the change
                    else if (previousPriceStr !== currentPriceStr) {
                        animateChange(previousPriceStr, currentPriceStr);
                    }
                    
                    previousPriceStr = currentPriceStr;
                    return; // Exit if successful
                    
                } catch (apiError) {
                    console.warn('API fetch failed, using simulated data instead:', apiError);
                    // Continue to fallback
                }
                
                // Fallback: Use simulated price changes
                const basePrice = previousPriceStr ? parseInt(previousPriceStr.replace(/,/g, '')) : 65000;
                // Generate a simulated price change (up or down by 0-2%)
                const changePercent = (Math.random() * 4) - 2; // -2% to +2%
                const newPrice = Math.floor(basePrice * (1 + (changePercent / 100)));
                const newPriceStr = newPrice.toString();
                
                // Update timestamp with simulation note
                timestampElement.textContent = `Simulated price (API unavailable): ${new Date().toLocaleString()}`;
                
                // If this is the first fetch, just show the price without animation
                if (previousPriceStr === null) {
                    updateDisplay(formatWithCommas(newPriceStr));
                } 
                // Otherwise, animate the change
                else if (previousPriceStr !== newPriceStr) {
                    animateChange(previousPriceStr, newPriceStr);
                }
                
                previousPriceStr = newPriceStr;
                
            } catch (error) {
                console.error('Error in price handling:', error);
                // Display error in the price container
                while (priceContainer.childNodes.length > 1) {
                    priceContainer.removeChild(priceContainer.lastChild);
                }
                const errorElement = document.createElement('div');
                errorElement.className = 'digit';
                errorElement.textContent = ' Error';
                priceContainer.appendChild(errorElement);
            }
        }

        // Start with simulated price first
        if (previousPriceStr === null) {
            previousPriceStr = "65000"; // Start with a default Bitcoin price
            updateDisplay(formatWithCommas(previousPriceStr));
        }
        
        // Initial fetch
        fetchBitcoinPrice();

        // Update price every 30 seconds
        setInterval(fetchBitcoinPrice, 30000);

        // Make price update when clicking anywhere
        document.body.addEventListener('click', () => {
            // Generate a different random number for testing the animation
            if (previousPriceStr !== null) {
                const currentVal = parseInt(previousPriceStr.replace(/,/g, ''));
                // Generate a more realistic price change (up or down by 0-1%)
                const changePercent = (Math.random() * 2) - 1; // -1% to +1%
                const newVal = Math.floor(currentVal * (1 + (changePercent / 100)));
                animateChange(previousPriceStr, newVal.toString());
                previousPriceStr = newVal.toString();
                
                // Update timestamp
                timestampElement.textContent = `Manual update: ${new Date().toLocaleString()}`;
            }
        });
    </script>
</body>
</html>